<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Whellote</title>

  
  <meta name="author" content="whellote">
  

  
  <meta name="description" content="snap.js 阅读1. 调用与入口123var c1 = svg1.paper.circle(50, 50, 40).attr(&amp;#123;    fill: &#34;#f00&#34;&amp;#125;);
根据上一篇 svg1 = Snap(‘svg1’) 可知, 实际上svg1 是 snap 中的 Elemen">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="Whellote"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Whellote" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Whellote</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span></span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/05/02/snap.js读码(二)/" rel="bookmark">
        <time class="entry-date published" datetime="2018-05-02T04:19:35.450Z">
          2018-05-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="snap-js-阅读"><a href="#snap-js-阅读" class="headerlink" title="snap.js 阅读"></a>snap.js 阅读</h1><h2 id="1-调用与入口"><a href="#1-调用与入口" class="headerlink" title="1. 调用与入口"></a>1. 调用与入口</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c1 = svg1.paper.circle(<span class="number">50</span>, <span class="number">50</span>, <span class="number">40</span>).attr(&#123;</span><br><span class="line">    fill: <span class="string">"#f00"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>根据上一篇 svg1 = Snap(‘svg1’) 可知, 实际上svg1 是 snap 中的 Element.<br>这句代码就是找Element.paper.circle().attr({}); 的用法<br>而在paper里有 res = new Element(w); res.paper = res;<br>所以就相当于直接找Element.circle()</p>
<p>查找了一下并没有Element.circle, 进一步找 paper.circle 也没有, 编辑器自己跳到一个 Snap.plugin 里面. 在snap中定义了Snap.plugin, 在第二层自执行函数return语句前面用Snap.plugin();的方式装载了一些自定义的扩展<br>而circle 就在其中的一个 Snap.plugin 中.</p>
<p>circle的定义及源码注释如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">* Paper.circle</span><br><span class="line"> [ method ]</span><br><span class="line"> **</span><br><span class="line"> * Draws a circle</span><br><span class="line"> **</span><br><span class="line"> - x (number) x coordinate <span class="keyword">of</span> the centre</span><br><span class="line"> - y (number) y coordinate <span class="keyword">of</span> the centre</span><br><span class="line"> - r (number) radius</span><br><span class="line"> = (object) the <span class="string">`circle`</span> element</span><br><span class="line"> **</span><br><span class="line"> &gt; Usage</span><br><span class="line"> | <span class="keyword">var</span> c = paper.circle(<span class="number">50</span>, <span class="number">50</span>, <span class="number">40</span>);</span><br><span class="line">\*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">    proto.circle = function (cx, cy, r) &#123;</span></span><br><span class="line"><span class="regexp">        var attr;</span></span><br><span class="line"><span class="regexp">        if (is(cx, "object") &amp;&amp; cx == "[object Object]") &#123;</span></span><br><span class="line"><span class="regexp">            attr = cx;</span></span><br><span class="line"><span class="regexp">        &#125; else if (cx != null) &#123;</span></span><br><span class="line"><span class="regexp">            attr = &#123;</span></span><br><span class="line"><span class="regexp">                cx: cx,</span></span><br><span class="line"><span class="regexp">                cy: cy,</span></span><br><span class="line"><span class="regexp">                r: r</span></span><br><span class="line"><span class="regexp">            &#125;;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        return this.el("circle", attr);</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br></pre></td></tr></table></figure></p>
<p>如果cx 是属性, 则默认为键值对的列表直接, 如果不是, 将cx, cy, r 做成一个键值对列表(对象), 执行的是 this.el();</p>
<h2 id="2-Paper-prototype-el"><a href="#2-Paper-prototype-el" class="headerlink" title="2. Paper.prototype.el"></a>2. Paper.prototype.el</h2><p>从circle接收到的参数,传给了el, 使得能够通过paper.circle调用(所以 circle实际的工作就是整理了一下attr)   </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Paper.prototype.el = <span class="function"><span class="keyword">function</span> (<span class="params">name, attr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> el = make(name, <span class="keyword">this</span>.node);</span><br><span class="line">    attr &amp;&amp; el.attr(attr);</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="3-make"><a href="#3-make" class="headerlink" title="3. make"></a>3. make</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make</span>(<span class="params">name, parent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> res = $(name);</span><br><span class="line">    parent.appendChild(res);</span><br><span class="line">    <span class="keyword">var</span> el = wrap(res);</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里用到了$()根据笔记(一)知道实现的是 <code>document.createElementNS(xmlns, el)</code></p>
<p>所以 <code>make</code> 翻译一下就是<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make</span>(<span class="params">name, parent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="built_in">document</span>.createElementNS(xmlns, name);</span><br><span class="line">    parent.appendChild(res);</span><br><span class="line">    <span class="keyword">var</span> el = wrap(res);</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>继续往上 到Paper.prototype.el 的话就是<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Paper.prototype.el = <span class="function"><span class="keyword">function</span> (<span class="params">name, attr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="built_in">document</span>.createElementNS(xmlns, name);</span><br><span class="line">    <span class="keyword">this</span>.node.appendChild(res);</span><br><span class="line">    <span class="keyword">var</span> el = wrap(res);</span><br><span class="line">    attr &amp;&amp; el.attr(attr);</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>最后到顶层的circle定义时是:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> proto.circle = <span class="function"><span class="keyword">function</span> (<span class="params">cx, cy, r</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> attr;</span><br><span class="line">    <span class="keyword">if</span> (is(cx, <span class="string">"object"</span>) &amp;&amp; cx == <span class="string">"[object Object]"</span>) &#123;</span><br><span class="line">        attr = cx;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cx != <span class="literal">null</span>) &#123;</span><br><span class="line">        attr = &#123;</span><br><span class="line">            cx: cx,</span><br><span class="line">            cy: cy,</span><br><span class="line">            r: r</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> res = <span class="built_in">document</span>.createElementNS(xmlns, <span class="string">"circle"</span>);</span><br><span class="line">    <span class="keyword">this</span>.node.appendChild(res);</span><br><span class="line">    <span class="keyword">var</span> el = wrap(res);</span><br><span class="line">    attr &amp;&amp; el.attr(attr);</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>那么入口为<br><code>var c0 = svg1.circle(50, 50, 40).attr({fill: &quot;#ff0&quot;});</code><br>或者<br><code>var c1 = svg1.paper.circle(50, 50, 40).attr({fill: &quot;#f00&quot;});</code><br>的代码的历程就只剩下 wrap(res) 和 attr() 这两步没有解决了(wrap文档(一)里面看过了, 但这次看是不是走了其他分支)</p>
<h2 id="4-wrap"><a href="#4-wrap" class="headerlink" title="4. wrap()"></a>4. wrap()</h2><p>回顾一下~ 我们文档(一)里是Snap(‘#svg1’);传到wrap的时候, 走了第三个分支即<br><code>if (dom.tagName &amp;&amp; dom.tagName.toLowerCase() == &quot;svg&quot;) {</code><br>那么这一次呢? 我们的参数即wrap中的dom 是 res, 即 <code>var res = document.createElementNS(xmlns, &quot;circle&quot;);</code> 所以结论应该是不走判断,直接返回</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrap</span>(<span class="params">dom</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!dom) &#123;</span><br><span class="line">        <span class="keyword">return</span> dom;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dom <span class="keyword">instanceof</span> Element || dom <span class="keyword">instanceof</span> Fragment) &#123;</span><br><span class="line">        <span class="keyword">return</span> dom;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dom.tagName &amp;&amp; dom.tagName.toLowerCase() == <span class="string">"svg"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Paper(dom);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dom.tagName &amp;&amp; dom.tagName.toLowerCase() == <span class="string">"object"</span> &amp;&amp; dom.type == <span class="string">"image/svg+xml"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Paper(dom.contentDocument.getElementsByTagName(<span class="string">"svg"</span>)[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Element(dom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过了wrap, 将整个路径的代码再次合并的话是:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> proto.circle = <span class="function"><span class="keyword">function</span> (<span class="params">cx, cy, r</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> attr;</span><br><span class="line">    <span class="keyword">if</span> (is(cx, <span class="string">"object"</span>) &amp;&amp; cx == <span class="string">"[object Object]"</span>) &#123;</span><br><span class="line">        attr = cx;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cx != <span class="literal">null</span>) &#123;</span><br><span class="line">        attr = &#123;</span><br><span class="line">            cx: cx,</span><br><span class="line">            cy: cy,</span><br><span class="line">            r: r</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> res = <span class="built_in">document</span>.createElementNS(xmlns, <span class="string">"circle"</span>);</span><br><span class="line">    <span class="keyword">this</span>.node.appendChild(res);</span><br><span class="line">    <span class="keyword">var</span> el = <span class="keyword">new</span> Element(res);</span><br><span class="line">    attr &amp;&amp; el.attr(attr);</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>element在文档一也看过了, 这次看看是否也会有不同</p>
<h2 id="5-Element"><a href="#5-Element" class="headerlink" title="5 Element"></a>5 Element</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Element</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> svg;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        svg = el.ownerSVGElement;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.node = el;</span><br><span class="line">    <span class="keyword">if</span> (svg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.paper = <span class="keyword">new</span> Paper(svg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.type = el.tagName || el.nodeName;</span><br><span class="line">    <span class="keyword">var</span> id = <span class="keyword">this</span>.id = ID(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.anims = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>._ = &#123;</span><br><span class="line">        transform: []</span><br><span class="line">    &#125;;</span><br><span class="line">    el.snap = id;</span><br><span class="line">    hub[id] = <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现也是生成了一个snap特色的dom对象, 装配了一些属性, 并注册进一些全局变量, 具体的是: (这次具体一下好了)<br>如果是svg元素的话<br>node: 原生DOM–至少这里初始化的时候是<br>type: 元素的标签名<br>id: 随机生成的唯一id<br>anims: 空对象,目前不知道用途<br>_: 里面有一个属性是<code>transform: []</code></p>
<p>对其他对象的影响:<br>el.snap = id (将id 赋给了传进来的参数, 即原生的DOM)<br>hub[id] = this; 把这个新初始化的element对象注册到了hub数组中</p>
<p>如果是隶属于svg但不是<code>g, mask, pattern, symbol</code>的话<br>同上多了个this.paper = 顶层svg元素(DOM原生)</p>
<p>所以element作用就是完成了snap特色的dom元素<br>到此为止, 进入下一步 attr</p>
<h2 id="6-attr"><a href="#6-attr" class="headerlink" title="6 attr()"></a>6 attr()</h2><p>看上面的整合代码可知, el是一个element对象, 所以要找的是element.attr<br>传进来的参数是这样的: <code>el.attr(attr)</code> (attr 是一个对象, 记录了圆的顶点坐标和半径)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> has = <span class="string">"hasOwnProperty"</span>;</span><br><span class="line">Element.prototype.attr = <span class="function"><span class="keyword">function</span> (<span class="params">params, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> el = <span class="keyword">this</span>,</span><br><span class="line">        node = el.node;</span><br><span class="line">    <span class="keyword">if</span> (!params) &#123;...&#125;</span><br><span class="line">    <span class="keyword">if</span> (is(params, <span class="string">"string"</span>))&#123;...&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> att <span class="keyword">in</span> params) &#123;</span><br><span class="line">        <span class="keyword">if</span> (params[has](att)) &#123;</span><br><span class="line">            eve(<span class="string">"snap.util.attr."</span> + att, el, params[att]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>简单来说就是遍历attr对象然后每个属性都调用<br><code>eve(&quot;snap.util.attr.&quot; + att, el, params[att]);</code><br>所以下一步是eve</p>
<h2 id="7-eve"><a href="#7-eve" class="headerlink" title="7. eve"></a>7. eve</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">eve = <span class="function"><span class="keyword">function</span> (<span class="params">name, scope</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> e = events,</span><br><span class="line">        oldstop = stop,</span><br><span class="line">        args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">2</span>),</span><br><span class="line">        listeners = eve.listeners(name),</span><br><span class="line">        z = <span class="number">0</span>,</span><br><span class="line">        f = <span class="literal">false</span>,</span><br><span class="line">        l,</span><br><span class="line">        indexed = [],</span><br><span class="line">        queue = &#123;&#125;,</span><br><span class="line">        out = [],</span><br><span class="line">        ce = current_event,</span><br><span class="line">        errors = [];</span><br><span class="line">    out.firstDefined = firstDefined;</span><br><span class="line">    out.lastDefined = lastDefined;</span><br><span class="line">    current_event = name;</span><br><span class="line">    stop = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, ii = listeners.length; i &lt; ii; i++) <span class="keyword">if</span> (<span class="string">"zIndex"</span> <span class="keyword">in</span> listeners[i]) &#123;</span><br><span class="line">        indexed.push(listeners[i].zIndex);</span><br><span class="line">        <span class="keyword">if</span> (listeners[i].zIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            queue[listeners[i].zIndex] = listeners[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    indexed.sort(numsort);</span><br><span class="line">    <span class="keyword">while</span> (indexed[z] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        l = queue[indexed[z++]];</span><br><span class="line">        out.push(l.apply(scope, args));</span><br><span class="line">        <span class="keyword">if</span> (stop) &#123;</span><br><span class="line">            stop = oldstop;</span><br><span class="line">            <span class="keyword">return</span> out;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; ii; i++) &#123;</span><br><span class="line">        l = listeners[i];</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"zIndex"</span> <span class="keyword">in</span> l) &#123;</span><br><span class="line">            <span class="keyword">if</span> (l.zIndex == indexed[z]) &#123;</span><br><span class="line">                out.push(l.apply(scope, args));</span><br><span class="line">                <span class="keyword">if</span> (stop) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    z++;</span><br><span class="line">                    l = queue[indexed[z]];</span><br><span class="line">                    l &amp;&amp; out.push(l.apply(scope, args));</span><br><span class="line">                    <span class="keyword">if</span> (stop) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">while</span> (l)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                queue[l.zIndex] = l;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            out.push(l.apply(scope, args));</span><br><span class="line">            <span class="keyword">if</span> (stop) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stop = oldstop;</span><br><span class="line">    current_event = ce;</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>前面一堆变量赋值, 到循环<code>for (var i = 0, ii = listeners.length; i &lt; ii; i++)</code><br>需要看一下listeners是什么, 即 <code>eve.listeners(name)</code> 其中name 值是: <code>snap.util.attr.cx</code></p>
<h2 id="8-listeners"><a href="#8-listeners" class="headerlink" title="8. listeners"></a>8. listeners</h2><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="Snap-plugin-的代码及注释"><a href="#Snap-plugin-的代码及注释" class="headerlink" title="Snap.plugin 的代码及注释"></a>Snap.plugin 的代码及注释</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* Snap.plugin</span><br><span class="line"> [ method ]</span><br><span class="line"> **</span><br><span class="line"> * Let you write plugins. You pass <span class="keyword">in</span> a <span class="function"><span class="keyword">function</span> <span class="title">with</span> <span class="title">five</span> <span class="title">arguments</span>, <span class="title">like</span> <span class="title">this</span>:</span></span><br><span class="line"><span class="function"> | <span class="title">Snap</span>.<span class="title">plugin</span>(<span class="params">function (Snap, Element, Paper, global, Fragment</span>) </span>&#123;</span><br><span class="line"> |     Snap.newmethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"> |     Element.prototype.newmethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"> |     Paper.prototype.newmethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"> | &#125;);</span><br><span class="line"> * Inside the <span class="function"><span class="keyword">function</span> <span class="title">you</span> <span class="title">have</span> <span class="title">access</span> <span class="title">to</span> <span class="title">all</span> <span class="title">main</span> <span class="title">objects</span> (<span class="params">and their</span></span></span><br><span class="line"><span class="function"><span class="params"> * prototypes</span>). <span class="title">This</span> <span class="title">allow</span> <span class="title">you</span> <span class="title">to</span> <span class="title">extend</span> <span class="title">anything</span> <span class="title">you</span> <span class="title">want</span>.</span></span><br><span class="line"><span class="function"> **</span></span><br><span class="line"><span class="function"> - <span class="title">f</span> (<span class="params">function</span>) <span class="title">your</span> <span class="title">plugin</span> <span class="title">body</span></span></span><br><span class="line"><span class="function">\*/</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Snap</span>.<span class="title">plugin</span> = <span class="title">function</span> (<span class="params">f</span>) </span>&#123;</span><br><span class="line">    f(Snap, Element, Paper, glob, Fragment);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="eve-listeners-name-其中name-值是-snap-util-attr-cx"><a href="#eve-listeners-name-其中name-值是-snap-util-attr-cx" class="headerlink" title="eve.listeners(name) 其中name 值是: snap.util.attr.cx"></a><code>eve.listeners(name)</code> 其中name 值是: <code>snap.util.attr.cx</code></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> separator = <span class="regexp">/[\.\/]/</span>;</span><br><span class="line">eve.listeners = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> names = isArray(name) ? name : name.split(separator),</span><br><span class="line">        e = events,</span><br><span class="line">        item,</span><br><span class="line">        items,</span><br><span class="line">        k,</span><br><span class="line">        i,</span><br><span class="line">        ii,</span><br><span class="line">        j,</span><br><span class="line">        jj,</span><br><span class="line">        nes,</span><br><span class="line">        es = [e],</span><br><span class="line">        out = [];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, ii = names.length; i &lt; ii; i++) &#123;</span><br><span class="line">        nes = [];</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>, jj = es.length; j &lt; jj; j++) &#123;</span><br><span class="line">            e = es[j].n;</span><br><span class="line">            items = [e[names[i]], e[wildcard]];</span><br><span class="line">            k = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">while</span> (k--) &#123;</span><br><span class="line">                item = items[k];</span><br><span class="line">                <span class="keyword">if</span> (item) &#123;</span><br><span class="line">                    nes.push(item);</span><br><span class="line">                    out = out.concat(item.f || []);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        es = nes;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>

  



    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 whellote
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>